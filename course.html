<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Course â€“ Sustainability Hub</title>
  <link rel="stylesheet" href="assets/css/styles.css" />
  <script src="data/courses.js" defer></script>
  <script src="assets/js/app.js" defer></script>
  <script src="assets/js/certificates.js" defer></script>
</head>
<body>
<header class="site-header">
  <div class="container topbar">
    <a class="brand" href="index.html"><span class="dot"></span>Sustainability&nbsp;Hub</a>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="courses.html">Courses</a>
      <a href="resources.html">Resources</a>
      <a href="certificates.html">Certificates</a>
      <button class="theme-toggle" data-action="toggle-theme" aria-pressed="false" title="Toggle theme">ðŸŒ“</button>
    </nav>
  </div>
</header>

<main class="container section" id="course-root">
  <!-- Injected -->
</main>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  const qs = new URLSearchParams(location.search);
  const id = qs.get('id');
  const course = window.COURSES.find(c => c.id === id) || window.COURSES[0];

  const prog = await SustHub.getCourseProgress(course.id, course.modules);
  const progressData = await SustHub.readProgress();

  const modulesList = course.modules.map(m => `
    <li class="card" style="list-style: none;">
      <h3>${m.title} <span class="badge">${m.duration} min</span></h3>
      <p class="meta">Module ID: ${m.id}</p>
      <div class="grid" style="grid-template-columns: 1fr auto; align-items: center;">
        <div class="grid" style="gap:.4rem;">
          <a class="btn" href="module.html?course=${encodeURIComponent(course.id)}&module=${encodeURIComponent(m.id)}">Watch module</a>
          ${m.quiz ? `<a class="btn" href="quiz.html?course=${encodeURIComponent(course.id)}&module=${encodeURIComponent(m.id)}">Take quiz</a>` : ``}
        </div>
        <div class="badge" aria-live="polite">${(progressData?.[course.id]?.[m.id]?.complete) ? 'Completed' : 'Not started'}</div>
      </div>
    </li>
  `).join('');

  const resources = [...new Set(course.modules.flatMap(m => m.resources || []))]
    .map(r => `<li><a href="${r.url}" target="_blank" rel="noopener">${r.title}</a></li>`).join('');

  document.getElementById('course-root').innerHTML = `
    <article class="card">
      <h1>${course.title}</h1>
      <p class="meta">${course.category} â€¢ ${course.level} â€¢ ~${course.estimate} mins</p>
      <p>${course.summary}</p>
      <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="${prog.pct}">
        <span style="width:${prog.pct}%"></span>
      </div>
      <p class="meta">${prog.done}/${prog.total} modules completed</p>
      <div id="cert-cta"></div>
    </article>

    <section class="section">
      <h2>Modules</h2>
      <ul class="grid" style="padding:0;">${modulesList}</ul>
    </section>

    <section class="section">
      <h2>Course Resources</h2>
      <ul>${resources || '<li>No resources yet.</li>'}</ul>
    </section>
  `;

  // Initialize certificate CTA
  window.SustHubCerts?.initCourseCertificateCTA(course);
});
</script>
</body>
</html>
